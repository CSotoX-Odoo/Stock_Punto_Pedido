<?xml version="1.0" encoding="utf-8"?>
<odoo>
<!--
    Carlos Rafael Soto (CSotoX)
    Odoo.soporte@gmail.com
    Odoo v11

    - CRE 20/FEB/2018 (CSOTOX)
    - MOD 22/FEB/2018 (CSOTOX)
      - El nuevo filtro esta basado en el valor calculado de: x_punto_pedido
        ahora solo muestra los productos que tienen Stock Bajo

-->

    <!--
        Esta Vista es la que muestra la lista de productos con Stock bajo
    -->
    <record id="noti_stock_bajo_view" model="ir.ui.view">
        <field name="name">noti.stock.bajo.view</field>
        <field name="model">product.template</field>
        <field name="type">tree</field>
        <field name="priority" eval="16"/>
        <field name="arch" type="xml">
            <tree create="false" edit="false" delete="false">
                <field name="default_code" string="Referencia"/>
                <field name="display_name" string="Producto"/>
                <field name="qty_available" string="Stock a mano"/>
                <field name="reordering_min_qty" string="Stock min"/>
                <field name="reordering_max_qty" string="Stock max"/>
                <field name="uom_id" string="Unidad de Venta"/>
                <field name="uom_po_id" string="Unidad de Compra"/>
                <field name="standard_price" string="Costo"/>
            </tree>
        </field>
    </record>

    <!--
        Aplico los filtros de manera automatica para:
            - Muestro solamente productos almacenables
            - Que tengan regla de abastecimiento
            - Que el Stock a Mano sea menor al Stock Mínimo
    -->
    <record id="noti_stock_bajo_action" model="ir.actions.act_window">
        <field name="name">Productos con Stock Bajo</field>
        <field name="view_id" ref="noti_stock_bajo_view"/>
        <field name="res_model">product.template</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="domain" eval="[('type','=', 'product'), ('x_punto_pedido', '=', True)]"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
            No hay productos con Stock Bajo.
            </p><p>
            Todos los productos cumplen con los niveles de Stock deseado.

            Los productos listados en esta pantalla, vienen de cumplir
            con los Stock definidos en las Reglas de Abastecimiento. Si ningun
            producto aparece en esta pantalla, es porque cumple con los niveles
            de Stock o no tiene una Regla de Abastecimiento.
            </p>
        </field>
    </record>

    <!--
        Definimos el Sub-Menu
        Ruta: Aplicación Inventario -> Informes
    -->
    <menuitem id="noti_stock_bajo_menu"
        action="noti_stock_bajo_action" 
        name="Productos con Stock Bajo"
        parent="stock.menu_warehouse_report" 
        sequence="200" 
        groups="stock.group_stock_user"/>
</odoo>
