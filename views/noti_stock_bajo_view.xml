<?xml version="1.0" encoding="utf-8"?>
<odoo>
<!--
    Carlos Rafael Soto (CSotoX)
    Odoo.soporte@gmail.com
    Odoo v11

    - CRE 20/FEB/2018 (CSOTOX)

    - Muestra el campo de punto de pedido para tener una visual de lo que ocurre
      no vale la pena actualizar este archivo
      x_punto_pedido

      
-->

    <!--
        Esta Vista es la que muestra la lista de productos con Stock bajo
    -->
    <record id="noti_stock_bajo_view" model="ir.ui.view">
        <field name="name">noti.stock.bajo.view</field>
        <field name="model">product.template</field>
        <field name="type">tree</field>
        <field name="priority" eval="16"/>
        <field name="arch" type="xml">
            <tree create="false" edit="false" delete="false">
                <field name="default_code" string="Referencia"/>
                <field name="display_name" string="Producto"/>
                <field name="qty_available" string="Stock a mano"/>
                <field name="reordering_min_qty" string="Stock min"/>
                <field name="reordering_max_qty" string="Stock max"/>
                <field name="uom_id" string="Unidad de Venta"/>
                <field name="uom_po_id" string="Unidad de Compra"/>
                <field name="standard_price" string="Costo"/>
                <field name="x_punto_pedido" string="PuntoPed"/>
            </tree>
        </field>
    </record>

    <!--
        Aplico los filtros de manera automatica para:
            - Mostrar solamente registros cuya propiedad Type = product
        
        Faltan filtros:
            - Que el Stock a mano sea menor o igual al Stock minimo
              configurado en las reglas de abastecimiento
              ('qty_available', '<=', 'reordering_min_qty')
              No se por que no funciona
            - Que solo muestre los productos que tienen regla de abastecimiento
              ('nbr_reordering_rules', '!=', 0)
              Tampoco quiere funcionar.

    -->
    <record id="noti_stock_bajo_action" model="ir.actions.act_window">
        <field name="name">Productos con Stock Bajo</field>
        <field name="view_id" ref="noti_stock_bajo_view"/>
        <field name="res_model">product.template</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="domain" eval="[('type', '=', 'product')]"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
            No hay productos con Stock Bajo.
            </p><p>
            Todos los productos cumplen con los niveles de Stock deseado.

            Los productos listados en esta pantalla, vienen de cumplir
            con los Stock definidos en las Reglas de Abastecimiento. Si ningun
            producto aparece en esta pantalla, es porque cumple con los niveles
            de Stock o no tiene una Regla de Abastecimiento.
            </p>
        </field>
    </record>

<!--
eval="[('picking_id.picking_type_id.code','=','incoming'), ('location_id.usage','!=','internal'), ('location_dest_id.usage', '=', 'internal')]"/>
-->

    <!--
        Definimos el Sub-Menu
        Ruta: AplicaciÃ³n Inventario -> Informes
    -->
    <menuitem id="noti_stock_bajo_menu"
        action="noti_stock_bajo_action" 
        name="Productos con Stock Bajo"
        parent="stock.menu_warehouse_report" 
        sequence="200" 
        groups="stock.group_stock_user"/>
</odoo>
